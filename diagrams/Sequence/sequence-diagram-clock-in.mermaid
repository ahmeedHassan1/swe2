---
title: Sequence Diagram - Employee Clock In Process
---
sequenceDiagram
    actor Employee
    participant Frontend
    participant APIGateway as API Gateway
    participant AttendanceService as Attendance Service
    participant Database as Attendance DB

    Employee->>Frontend: Navigate to Attendance page
    Frontend->>APIGateway: GET /api/attendance/today?employeeId={id}<br/>Authorization: Bearer {token}
    APIGateway->>APIGateway: Validate JWT token
    APIGateway->>AttendanceService: Forward request
    
    AttendanceService->>Database: SELECT * FROM attendance<br/>WHERE employee_id = ? AND date = today
    
    alt Already Clocked In Today
        Database-->>AttendanceService: Attendance record found
        AttendanceService-->>APIGateway: {id, clockInTime, clockOutTime, ...}
        APIGateway-->>Frontend: Attendance data
        Frontend-->>Employee: Display Clock Out button
    else Not Clocked In
        Database-->>AttendanceService: No record
        AttendanceService-->>APIGateway: null/404
        APIGateway-->>Frontend: No attendance today
        Frontend-->>Employee: Display Clock In button
        
        Employee->>Frontend: Click Clock In
        Frontend->>APIGateway: POST /api/attendance/clock-in<br/>{employeeId, notes}<br/>Authorization: Bearer {token}
        APIGateway->>APIGateway: Validate JWT token
        APIGateway->>AttendanceService: Forward request
        
        AttendanceService->>Database: SELECT * FROM attendance<br/>WHERE employee_id = ? AND date = today
        Database-->>AttendanceService: Check for existing record
        
        alt Already Exists
            AttendanceService-->>APIGateway: 400 Already clocked in
            APIGateway-->>Frontend: Error response
            Frontend-->>Employee: Display error message
        else No Record
            AttendanceService->>AttendanceService: Create new Attendance entity
            AttendanceService->>AttendanceService: Set clockInTime = now()
            AttendanceService->>AttendanceService: Set date = today
            
            alt Current time >= 9:00 AM
                AttendanceService->>AttendanceService: Set status = LATE
            else Current time < 9:00 AM
                AttendanceService->>AttendanceService: Set status = PRESENT
            end
            
            AttendanceService->>AttendanceService: Set notes (if provided)
            AttendanceService->>AttendanceService: Set createdAt = now()
            
            AttendanceService->>Database: INSERT INTO attendance<br/>(employee_id, clock_in_time, date, status, notes, created_at)
            Database-->>AttendanceService: Record saved with ID
            
            AttendanceService-->>APIGateway: 200 {id, employeeId, clockInTime, date, status}
            APIGateway-->>Frontend: Attendance response
            
            Frontend->>Frontend: Update UI
            Frontend-->>Employee: Display success message<br/>"Clocked in successfully"
            Frontend->>Frontend: Refresh attendance history
            Frontend-->>Employee: Show Clock Out button
        end
    end
