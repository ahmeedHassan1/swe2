---
title: Sequence Diagram - Leave Request Submission and Approval
---
sequenceDiagram
    actor Employee
    participant EmpFrontend as Employee Frontend
    participant APIGateway as API Gateway
    participant LeaveService as Leave Service
    participant LeaveDB as Leave DB
    actor Admin
    participant AdminFrontend as Admin Frontend

    rect rgb(230, 245, 255)
        Note over Employee,LeaveDB: PART 1: Employee Submits Leave Request
        
        Employee->>EmpFrontend: Navigate to Leaves page
        Employee->>EmpFrontend: Click "New Request"
        EmpFrontend-->>Employee: Display leave request form
        
        Employee->>EmpFrontend: Fill form:<br/>Type, Start Date, End Date, Reason
        Employee->>EmpFrontend: Click Submit
        
        EmpFrontend->>EmpFrontend: Validate dates locally
        
        alt End Date < Start Date
            EmpFrontend-->>Employee: Display validation error
        else Dates Valid
            EmpFrontend->>APIGateway: POST /api/leaves<br/>{employeeId, type, startDate, endDate, reason}<br/>Authorization: Bearer {token}
            APIGateway->>APIGateway: Validate JWT token
            APIGateway->>LeaveService: Forward request
            
            LeaveService->>LeaveService: Create LeaveRequest entity
            LeaveService->>LeaveService: Set status = PENDING
            LeaveService->>LeaveService: Set createdAt = now()
            
            LeaveService->>LeaveService: Validate business rules:<br/>- endDate >= startDate<br/>- startDate not in past
            
            alt Validation Fails
                LeaveService-->>APIGateway: 400 Validation error
                APIGateway-->>EmpFrontend: Error response
                EmpFrontend-->>Employee: Display error message
            else Validation Passes
                LeaveService->>LeaveDB: INSERT INTO leaves<br/>(employee_id, type, start_date, end_date, reason, status, created_at)
                LeaveDB-->>LeaveService: Record saved with ID
                
                LeaveService-->>APIGateway: 200 {id, employeeId, type, startDate,<br/>endDate, reason, status: PENDING, createdAt}
                APIGateway-->>EmpFrontend: Leave request created
                
                EmpFrontend-->>Employee: Display success:<br/>"Leave request submitted"
                EmpFrontend->>EmpFrontend: Redirect to leaves list
                EmpFrontend-->>Employee: Show request with PENDING status
            end
        end
    end

    rect rgb(255, 245, 230)
        Note over Admin,LeaveDB: PART 2: Admin Reviews and Approves/Rejects
        
        Admin->>AdminFrontend: Navigate to Leaves page
        AdminFrontend->>APIGateway: GET /api/leaves<br/>Authorization: Bearer {token}
        APIGateway->>APIGateway: Validate JWT & check ADMIN role
        APIGateway->>LeaveService: Forward request
        
        LeaveService->>LeaveDB: SELECT * FROM leaves<br/>ORDER BY created_at DESC
        LeaveDB-->>LeaveService: All leave requests
        LeaveService-->>APIGateway: List of leave requests
        APIGateway-->>AdminFrontend: Leave requests data
        
        AdminFrontend-->>Admin: Display all leaves in table
        
        alt Admin Approves
            Admin->>AdminFrontend: Click "Approve" button for request
            AdminFrontend->>APIGateway: PUT /api/leaves/{id}/status<br/>{status: APPROVED}<br/>Authorization: Bearer {token}
            APIGateway->>APIGateway: Validate JWT & check ADMIN role
            APIGateway->>LeaveService: Forward request
            
            LeaveService->>LeaveDB: SELECT * FROM leaves WHERE id = ?
            LeaveDB-->>LeaveService: Leave request
            
            alt Leave Not Found
                LeaveService-->>APIGateway: 404 Not found
                APIGateway-->>AdminFrontend: Error
                AdminFrontend-->>Admin: Display error
            else Leave Found
                LeaveService->>LeaveService: Set status = APPROVED
                LeaveService->>LeaveDB: UPDATE leaves<br/>SET status = 'APPROVED'<br/>WHERE id = ?
                LeaveDB-->>LeaveService: Record updated
                
                LeaveService-->>APIGateway: 200 Updated leave request
                APIGateway-->>AdminFrontend: Success response
                AdminFrontend->>AdminFrontend: Refresh leave list
                AdminFrontend-->>Admin: Display success message
            end
            
        else Admin Rejects
            Admin->>AdminFrontend: Click "Reject" button
            AdminFrontend->>APIGateway: PUT /api/leaves/{id}/status<br/>{status: REJECTED}<br/>Authorization: Bearer {token}
            APIGateway->>LeaveService: Forward request
            LeaveService->>LeaveService: Set status = REJECTED
            LeaveService->>LeaveDB: UPDATE leaves SET status = 'REJECTED'
            LeaveDB-->>LeaveService: Record updated
            LeaveService-->>APIGateway: 200 Updated leave request
            APIGateway-->>AdminFrontend: Success response
            AdminFrontend-->>Admin: Display updated status
        end
        
        Note over Employee,AdminFrontend: Employee refreshes their leaves page<br/>and sees updated status
    end
